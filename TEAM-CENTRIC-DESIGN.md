# チーム前提の設計思想

## 核心的な設計思想

### 1. 親・子という概念が邪魔
- **全員同じ視界を見たい**
- **情報格差を作りたくない**
- **ロールで遮断すると連携が死ぬ**

### 2. チーム前提のプロダクト
- **誰が何を考えてるかも含めて見たい**
- **タスクだけじゃなく「背景」も共有したい**

---

## 現状の問題点

### 1. ロールベースのアクセス制御

#### 現状
- `admin`ロール: すべての機能にアクセス可能
- `user`ロール: 基本的な機能にアクセス可能
- 利用者招待は`admin`のみ

#### 問題点
- **情報格差が生まれる**: `admin`だけが利用者を招待できる
- **連携が死ぬ**: ロールで遮断されると、チーム内で情報が共有されない
- **視界が異なる**: `admin`と`user`で見える情報が異なる

### 2. 情報共有の不足

#### 現状
- タスクは共有できる
- 顧客情報は会社単位で共有
- 議事録は会社単位で共有

#### 問題点
- **「背景」が共有されていない**: なぜそのタスクが必要なのか、なぜその判断をしたのかがわからない
- **「思考プロセス」が共有されていない**: 誰が何を考えているかがわからない
- **「文脈」が失われる**: タスクだけを見ても、全体像がわからない

---

## 新しい設計思想

### 原則1: 全員同じ視界

#### 実装方針
- **ロールによる情報の遮断を廃止**
- **すべての情報を会社単位で共有**
- **利用者管理はupmo-admin側で一元管理**

#### 変更点
1. **利用者招待機能の削除・非表示**
   - 現在: upmo-demo側で`admin`が利用者を招待できる
   - 変更後: upmo-demo側での利用者招待機能を削除または非表示
   - 理由: すべての利用者管理はupmo-admin側で一元管理
   - **フロー**: 
     - upmo-admin側で必要な人数分を最初に登録
     - その後別日に他の人を登録することも可能（upmo-admin側で）
     - upmo-demo側では利用者一覧の表示のみ（招待機能は非表示）

2. **すべての情報を会社単位で共有**
   - 顧客情報: 既に会社単位で共有 ✅
   - 営業案件: 会社単位で共有（現状は`userId`でフィルタリングされている可能性）
   - 議事録: 既に会社単位で共有 ✅
   - タスク: 既に共有可能 ✅
   - 契約書: 既に会社単位で共有 ✅

### 原則2: 既存情報の可視化・共有の改善

#### 実装方針
- **既存のメモ・議事録・進捗メモをより見やすく**
- **関連情報をリンクで表示**（タスク、顧客、案件、議事録の関連性がわかる）
- **時系列で表示**（情報の流れがわかる）

#### 既存フィールドの活用

**方針**: 新しいフィールドを追加するのではなく、既存のフィールドを活用

##### タスク
- `description`フィールドで背景を記録
- 関連する顧客、案件、議事録をリンクで表示

##### 進捗メモ
- `content`フィールドで思考プロセスを記録
- 関連する顧客、案件、議事録をリンクで表示

##### 顧客メモ
- `text`フィールドで判断理由を記録
- 関連する案件、議事録をリンクで表示

##### 議事録
- `notes`フィールドで議論の経緯を記録
- 関連する顧客、案件、タスクをリンクで表示

---

## 実装案

### フェーズ1: ロールによる遮断の廃止

#### 1.1 利用者招待機能の削除・非表示

**変更ファイル**: 
- `src/app/admin/users/page.tsx` - 利用者招待機能を非表示または削除
- `src/app/api/admin/users/route.ts` - POSTメソッドを削除または無効化（オプション）

**変更内容**:
```typescript
// 変更前
// upmo-demo側でadminが利用者を招待できる

// 変更後
// upmo-demo側での利用者招待機能を削除または非表示
// すべての利用者管理はupmo-admin側で一元管理
```

**フロー**:
1. upmo-admin側で必要な人数分を最初に登録
2. その後別日に他の人を登録することも可能（upmo-admin側で）
3. upmo-demo側では利用者一覧の表示のみ（招待機能は非表示）

#### 1.2 サイドバー設定の権限は維持

**変更なし**: サイドバー設定は`admin`のみが変更可能（現状維持）

#### 1.3 すべての情報を会社単位で共有

**確認・修正が必要な箇所**:
- 営業案件: `companyName`でフィルタリングされているか確認
- 進捗メモ: `companyName`でフィルタリングされているか確認
- タスク: 会社単位で共有されているか確認

### フェーズ2: 既存情報の可視化・共有の改善

#### 2.1 既存のメモ・議事録・進捗メモをより見やすく

**方針**: 新しいフィールドを追加するのではなく、既存の情報（メモ、議事録、進捗メモなど）をより見やすく、共有しやすくする

**改善内容**:
- メモ、議事録、進捗メモを時系列で表示
- 関連する情報（顧客、案件、議事録、タスク）をリンクで表示

### フェーズ3: UI/UXの改善

#### 3.1 既存情報の可視化

**実装内容**:
- タイムライン表示: タスク、進捗メモ、顧客対応、議事録を時系列で表示
- 関連項目の表示: 関連する顧客、案件、議事録、タスクを表示

#### 3.2 チーム全体の情報の可視化

**実装内容**:
- ダッシュボードに「チームの活動」セクションを追加
- 最近の進捗メモ、顧客対応、議事録を表示

---

## データ構造の変更

### データ構造は変更しない

**方針**: 新しいフィールドを追加するのではなく、既存のデータ構造を活用して、より見やすく、共有しやすくする

**既存のデータ構造を活用**:
- タスクの`description`フィールドで背景を記録
- 進捗メモの`content`フィールドで思考プロセスを記録
- 顧客メモの`text`フィールドで判断理由を記録
- 議事録の`notes`フィールドで議論の経緯を記録

**改善点**:
- 既存のフィールドをより見やすく表示
- 関連情報をリンクで表示

---

## セキュリティの考慮

### 1. 利用者管理の一元化

**upmo-admin側で一元管理**:
- すべての利用者管理はupmo-admin側で行う
- upmo-demo側では利用者一覧の表示のみ
- 利用者招待機能はupmo-admin側でのみ利用可能

### 2. 情報の共有範囲

**原則**: すべての情報を会社単位で共有
- 同じ`companyName`のユーザー間で情報を共有
- 異なる`companyName`のユーザー間では情報を共有しない

### 3. サイドバー設定の権限

**現状維持**:
- サイドバー設定は`admin`のみが変更可能
- 変更履歴の記録は不要（現状維持）

---

## 実装優先順位

### フェーズ1: ロールによる遮断の廃止（最優先）

1. **利用者招待機能の削除・非表示**
   - 実装時間: 1-2時間
   - 影響: 中（upmo-admin側で一元管理することで、管理が明確になる）

2. **すべての情報を会社単位で共有**
   - 実装時間: 2-4時間
   - 影響: 高（情報格差が解消）

### フェーズ2: 既存情報の可視化・共有の改善（高優先度）

4. **既存のメモ・議事録・進捗メモをより見やすく**
   - 実装時間: 3-4時間
   - 影響: 高（既存情報の見やすさが向上）

5. **関連情報のリンク表示**
   - 実装時間: 2-3時間
   - 影響: 高（情報の関連性が明確になる）

### フェーズ3: UI/UXの改善（中優先度）

6. **既存情報の可視化**
   - 実装時間: 4-6時間
   - 影響: 高（情報の見やすさが向上）

7. **チーム全体の情報の可視化**
   - 実装時間: 4-6時間
   - 影響: 高（チーム全体の情報が可視化）

---

## まとめ

### 核心的な設計思想

1. **全員同じ視界**: ロールによる遮断を廃止（利用者招待を除く）
2. **情報格差を作らない**: すべての情報を会社単位で共有
3. **連携を死なせない**: ロールで遮断しない
4. **既存情報の可視化**: 新しいフィールドを追加するのではなく、既存の情報をより見やすく、共有しやすくする

### 次のステップ

1. **フェーズ1の実装を開始**: ロールによる遮断の廃止（利用者招待機能の削除・非表示）
2. **フェーズ2の実装を開始**: 既存情報の可視化・共有の改善
3. **フェーズ3の実装を開始**: UI/UXの改善

---

## 確認事項

1. **利用者招待機能の削除・非表示**: upmo-demo側での利用者招待機能を削除または非表示。すべての利用者管理はupmo-admin側で一元管理
2. **サイドバー設定の権限は維持**: `admin`のみが変更可能（現状維持）
3. **新しいフィールドは追加しない**: 既存のフィールドを活用して、より見やすく、共有しやすくする

