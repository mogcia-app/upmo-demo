# 要件定義書

## プロジェクト概要

**プロジェクト名**: UPMO Demo  
**概要**: 企業向けの統合業務管理システム（営業管理、顧客管理、文書管理、タスク管理など）  
**メインカラー**: `#005eb2`

## 技術スタック

- **フレームワーク**: Next.js 15.5.9 (App Router)
- **言語**: TypeScript
- **スタイリング**: Tailwind CSS
- **バックエンド**: Firebase (Firestore, Authentication)
- **認証**: Firebase Authentication
- **データベース**: Cloud Firestore

## 主要機能

### 1. 認証・ユーザー管理
- Firebase Authenticationによるログイン機能
- ユーザー管理（管理者権限）
- 会社単位でのユーザー管理
- ロールベースのアクセス制御

### 2. ダッシュボード（ホームページ）
- AIチャット機能
- カレンダー表示
- 各種データのサマリー表示
- 通知機能

### 3. TODO管理
- タスクの作成・編集・削除
- ステータス管理（共有事項、ToDo、進行中、完了）
- 優先度設定
- 担当者割り当て
- AIによる自然言語でのTODO作成
- カンバンボード表示

### 4. 営業管理

#### 4.1 メモ（進捗メモ）
- メモの作成・編集・削除
- タブ機能（すべて、プライベート、共有、お気に入り）
- グリッド/リスト表示切り替え
- 共有機能
- お気に入り機能
- 検索機能
- 統計情報表示

#### 4.2 商談管理
- 商談の作成・編集・削除
- ステータス管理（見込み客、提案中、交渉中、成約、失注）
- フィルター機能（すべて、見込み客、提案中、交渉中、成約）
- 顧客情報管理
- 予想成約日、見積金額、成約確率の管理

#### 4.3 営業活動管理
- 営業活動の記録（訪問、電話、会議、メール）
- 会社名での管理
- 活動タイプ別フィルター
- カード形式での表示
- 詳細モーダル表示

#### 4.4 営業案件管理
- 案件の作成・編集・削除
- 顧客情報の紐付け
- 案件ステータス管理

### 5. 顧客管理
- 顧客情報の登録・編集・削除
- 顧客リスト管理
- 取引履歴の記録
- 顧客検索機能

### 6. 文書管理

#### 6.1 契約書管理
- 手動入力による文書作成
- AI文書解析機能
- カード形式での表示
- 文書の編集・削除
- 詳細モーダル表示

#### 6.2 テンプレート管理
- テンプレートの作成・編集・削除
- タブ機能
- 検索・ソート機能
- カスタムタブの作成

#### 6.3 議事録管理
- 議事録の作成・編集・削除
- アクション項目の管理
- TODOへの自動追加機能
- 担当者割り当て
- 顧客情報の紐付け

#### 6.4 ドキュメント管理
- 各種ドキュメントの管理
- ドキュメントの検索

### 7. カレンダー
- 予定の作成・編集・削除
- チームメンバーの予定表示
- カレンダービュー
- イベント詳細表示

### 8. 管理機能

#### 8.1 利用者管理
- ユーザーの追加・編集・削除
- ロール管理（管理者、一般ユーザー）
- 部署・役職の管理

#### 8.2 会社情報管理
- 会社の基本情報管理
- 会社詳細情報
- **カスタム情報管理**
  - グループ機能
  - 項目追加機能（タイトル + テキスト/URL）
  - URL自動判定機能
  - 項目ごとの表示

#### 8.3 請求書発行
- 請求書の作成・発行
- 請求書番号管理
- 顧客情報の紐付け

### 9. カスタムメニュー機能
- カスタムページの作成
- コンポーネントエディター
- データテーブルコンポーネント
- フォームコンポーネント
- カレンダーコンポーネント
- カスタムタブの管理

### 10. AI機能
- AIチャット機能（自然言語での検索・操作）
- AIによるTODO作成
- AIによる文書解析
- AIによる議事録要約

### 11. 通知機能
- リアルタイム通知
- 通知の削除機能
- 未読通知数の表示

## カスタムメニュー一覧

以下のメニュー項目が利用可能です：

### メインメニュー
1. **TODOリスト** (`/todo`)
   - タスク管理機能

2. **メモ** (`/sales/progress-notes`)
   - 自由に使えるメモ機能

3. **契約書管理** (`/admin/contracts`)
   - 契約書の管理

4. **利用者管理** (`/admin/users`)
   - ユーザー管理

5. **会社情報** (`/admin/company`)
   - 会社の基本情報

6. **請求書発行** (`/admin/invoice`)
   - 請求書の作成と発行

7. **カレンダー** (`/calendar`)
   - 予定の管理

### 営業管理カテゴリ
8. **商談管理** (`/sales/opportunities`)
   - 営業案件・商談の進捗管理

9. **見込み客管理** (`/sales/leads`)
   - リード・見込み客の管理

10. **営業活動管理** (`/sales/activities`)
    - 訪問記録・営業活動の記録

### 顧客管理カテゴリ
11. **顧客管理** (`/customers`)
    - 顧客情報・取引履歴の管理

12. **リスト** (`/customers/list`)
    - 顧客リストの管理

### 文書管理カテゴリ
13. **テンプレート管理** (`/templates`)
    - 文書テンプレートの管理

14. **議事録管理** (`/minutes`)
    - 会議の議事録管理

15. **ドキュメント管理** (`/documents`)
    - 各種ドキュメントの管理

## ページ一覧

### 認証
- `/login` - ログインページ

### メインページ
- `/` - ダッシュボード（ホームページ）

### TODO管理
- `/todo` - TODOリスト

### 営業管理
- `/sales/progress-notes` - メモ（進捗メモ）
- `/sales/opportunities` - 商談管理
- `/sales/activities` - 営業活動管理
- `/sales/cases` - 営業案件管理
- `/sales/orders` - 受注管理
- `/sales/quotes` - 見積管理

### 顧客管理
- `/customers` - 顧客管理
- `/customers/list` - 顧客リスト

### 文書管理
- `/admin/contracts` - 契約書管理
- `/templates` - テンプレート管理
- `/meeting-notes` - 打ち合わせメモ
- `/minutes` - 議事録管理
- `/documents` - ドキュメント管理

### 管理機能
- `/admin/users` - 利用者管理
- `/admin/company` - 会社情報
- `/admin/invoice` - 請求書発行

### その他
- `/calendar` - カレンダー
- `/personal-chat` - 個人チャット
- `/custom/[slug]` - カスタムページ
- `/billing` - 請求管理
- `/expenses` - 経費管理
- `/inventory` - 在庫管理
- `/purchases` - 購買管理
- `/reports` - レポート
- `/analytics` - 分析
- `/pdca/plan` - PDCA計画
- `/pdca/do` - PDCA実行
- `/pdca/check` - PDCA確認
- `/pdca/action` - PDCA改善

## UI/UXの特徴

### 統一されたレイアウト
- 全ページで統一されたレイアウトスタイル
- ページコンテナ: `min-h-screen bg-gray-50 -mx-4 lg:-mx-6`（画面いっぱい）
- ヘッダー: `bg-white border-b border-gray-100 px-6 sm:px-8 py-4`
- コンテンツエリア: `px-6 sm:px-8 py-6`
- 角丸なし（sharp-edged）のデザイン
- 白背景のカード表示

### レスポンシブデザイン
- モバイル・タブレット・デスクトップ対応
- Tailwind CSSのブレークポイントを使用

### カラースキーム
- メインカラー: `#005eb2`
- 背景色: `bg-gray-50`
- カード背景: `bg-white`
- ボーダー: `border-gray-200`

## データベース構造（Firestore）

### 主要コレクション
- `users` - ユーザー情報
- `todos` - TODOタスク
- `progressNotes` - 進捗メモ
- `salesCases` - 営業案件
- `salesActivities` - 営業活動
- `customers` - 顧客情報
- `manualDocuments` - 手動入力文書
- `templates` - テンプレート
- `meetingNotes` - 議事録
- `events` - カレンダーイベント
- `notifications` - 通知
- `sidebarConfig` - サイドバー設定
- `customTabs` - カスタムタブ
- `companyInfo` - 会社情報

### データ構造の特徴
- 会社単位でのデータ管理（`companyName`フィールド）
- ユーザー単位でのデータ管理（`userId`フィールド）
- タイムスタンプ管理（`createdAt`, `updatedAt`）
- 共有機能（`sharedWith`フィールド）

## 認証・権限管理

### 認証方式
- Firebase Authentication
- メール/パスワード認証

### 権限管理
- **管理者（admin）**: 全機能へのアクセス
- **一般ユーザー**: 基本機能へのアクセス
- 会社単位でのデータ分離

## APIエンドポイント

### 認証・ユーザー
- `/api/admin/users` - ユーザー管理

### 営業管理
- `/api/sales/progress-notes` - 進捗メモ
- `/api/sales/opportunities` - 商談管理
- `/api/sales/activities` - 営業活動
- `/api/sales/cases` - 営業案件
- `/api/sales/orders` - 受注管理
- `/api/sales/quotes` - 見積管理

### 顧客管理
- `/api/customers` - 顧客管理
- `/api/customers/list` - 顧客リスト

### 文書管理
- `/api/admin/save-manual-document` - 手動文書保存
- `/api/admin/get-manual-documents` - 手動文書取得
- `/api/admin/delete-manual-document` - 手動文書削除
- `/api/admin/parse-document` - 文書解析
- `/api/templates` - テンプレート管理
- `/api/templates/tabs` - テンプレートタブ
- `/api/meeting-notes` - 議事録管理
- `/api/meeting-notes/add-to-todo` - 議事録からTODO追加
- `/api/documents` - ドキュメント管理

### TODO管理
- `/api/todo/create-from-ai` - AIによるTODO作成

### その他
- `/api/events` - カレンダーイベント
- `/api/notifications` - 通知管理
- `/api/admin/sidebar-config` - サイドバー設定
- `/api/ai-chat` - AIチャット
- `/api/search` - 検索機能

## 主要な実装機能

### 1. カスタム情報管理（会社情報ページ）
- グループ機能による情報の整理
- 項目ごとのタイトル + テキスト/URL追加
- URL自動判定機能
- 項目ごとの表示

### 2. メモ機能の強化
- タブ機能（すべて、プライベート、共有、お気に入り）
- お気に入り機能
- 共有機能
- 作成者・共有者の表示

### 3. 営業活動管理
- 活動タイプ別フィルター
- 会社名での管理
- カード形式での表示

### 4. 議事録からTODOへの自動追加
- アクション項目の自動抽出
- 担当者割り当て
- TODOへの自動追加

### 5. 統一されたUI/UX
- 全ページで統一されたレイアウト
- 角丸なしのデザイン
- 白背景のカード表示
- レスポンシブデザイン

## 開発環境

### 必要な環境変数
- Firebase設定（`.env.local`）
  - `NEXT_PUBLIC_FIREBASE_API_KEY`
  - `NEXT_PUBLIC_FIREBASE_AUTH_DOMAIN`
  - `NEXT_PUBLIC_FIREBASE_PROJECT_ID`
  - `NEXT_PUBLIC_FIREBASE_STORAGE_BUCKET`
  - `NEXT_PUBLIC_FIREBASE_MESSAGING_SENDER_ID`
  - `NEXT_PUBLIC_FIREBASE_APP_ID`

### 開発サーバーの起動
```bash
npm run dev
```

### ビルド
```bash
npm run build
```

## 今後の拡張予定

- より詳細なレポート機能
- データエクスポート機能
- モバイルアプリ対応
- より高度なAI機能
- ワークフロー機能
- 承認機能

## 更新履歴

- 2024年: 初期開発
- カスタム情報管理機能の追加
- メモ機能の強化
- 営業活動管理機能の追加
- 統一されたUI/UXの実装
- 議事録からTODOへの自動追加機能

