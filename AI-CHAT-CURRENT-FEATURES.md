# AIチャット 現在の機能一覧

最終更新: 2024年（現在）

## 概要

AIチャットは、ユーザーの質問を理解し、Firestoreに保存されたデータを検索・取得して回答を生成します。メタデータベースの検索機能とアクション検出機能が実装されています。

---

## 1. 検索機能（メタデータベース検索）

以下のメニュー項目で、メタデータベースの検索機能が利用できます。

### 1.1 TODOリスト

**コレクション**: `todos`

**検索範囲**: ユーザー単位（自分のTODOのみ）

**検索可能なフィールド**:
- `text`（タスク、タイトル、内容、やること）
- `description`（説明、詳細、備考、メモ）
- `status`（ステータス、状態、状況）
- `priority`（優先度、優先、重要度）

**ステータス検索**:
- 「共有事項」「shared」「共有」「チーム共有」→ `shared`
- 「todo」「ToDo」「タスク」「やること」「未着手」「pending」「待機中」「未開始」→ `todo`
- 「進行中」「in-progress」「作業中」「実行中」→ `in-progress`
- 「完了」「completed」「完了事項」「終了」「済み」→ `completed`

**使用例**:
- 「TODOリストについて教えて」
- 「共有事項について教えて」
- 「進行中のタスクを確認したい」

---

### 1.2 進捗メモ

**コレクション**: `progressNotes`

**検索範囲**: ユーザー単位（自分の進捗メモのみ）

**検索可能なフィールド**:
- `title`（タイトル、件名、題名）
- `content`（内容、本文、メモ、記録）
- `caseTitle`（案件、案件名、関連案件）

**使用例**:
- 「進捗メモについて教えて」
- 「営業活動の進捗を確認したい」

---

### 1.3 契約書管理

**コレクション**: `manualDocuments`

**検索範囲**: 会社単位（会社全体で共有）

**検索可能なフィールド**:
- `title`（タイトル、契約書名、文書名、名称）
- `description`（説明、概要、内容、詳細）

**セクション検索**（特定のセクションのみを取得）:
- 「料金」「価格」「費用」「金額」「コスト」→ `pricing`
- 「説明」「概要」「内容」「詳細」「紹介」→ `overview`
- 「特徴」「機能」「仕様」「スペック」→ `features`
- 「手順」「使い方」「方法」「手続き」「プロセス」→ `procedures`
- 「サポート」「サポート情報」「ヘルプ」「支援」→ `support`
- 「規則」「ルール」「規約」「規定」→ `rules`
- 「条件」「条項」「約款」「規約」→ `terms`
- 「Q&A」「質問」「FAQ」「よくある質問」「質疑応答」→ `qa`

**使用例**:
- 「契約書について教えて」
- 「Signal.について教えて」
- 「Signal.の料金について教えて」
- 「Signal.のQ&Aを確認したい」

---

### 1.4 利用者管理

**コレクション**: `users`

**検索範囲**: 会社単位（会社全体で共有）

**検索可能なフィールド**:
- `displayName`（名前、表示名、氏名、ユーザー名）
- `email`（メール、メールアドレス、Eメール）
- `department`（部署、部門、セクション）
- `position`（役職、職位）

**使用例**:
- 「利用者について教えて」
- 「ユーザー一覧を確認したい」

---

### 1.5 会社情報

**コレクション**: `companyInfo`

**検索範囲**: 会社単位（会社全体で共有）

**検索可能なフィールド**:
- `name`（会社名、名称、企業名）
- `address`（住所、所在地）
- `phone`（電話、電話番号）
- `customItems.itemName`（項目名、カスタム情報）
- `customItems.value`（値、内容）

**使用例**:
- 「会社情報について教えて」
- 「会社の住所を確認したい」

---

### 1.6 請求書発行

**コレクション**: `invoices`

**検索範囲**: 会社単位（会社全体で共有）

**検索可能なフィールド**:
- `invoiceNumber`（請求書番号、番号）
- `customerName`（顧客名、取引先名）
- `totalAmount`（金額、合計金額）
- `issueDate`（発行日、日付）
- `dueDate`（支払期限、期限）

**使用例**:
- 「請求書について教えて」
- 「請求書一覧を確認したい」

---

### 1.7 営業案件（商談管理）

**コレクション**: `salesCases`

**検索範囲**: 会社単位 + ユーザー単位（会社全体で共有、担当者にも紐づく）

**検索可能なフィールド**:
- `title`（案件名、商談名、タイトル）
- `customerName`（顧客名、取引先名）
- `description`（概要、説明、内容）
- `status`（ステータス、状況）

**使用例**:
- 「商談について教えて」
- 「営業案件を確認したい」

---

### 1.8 見込み客管理

**コレクション**: `leads`

**検索範囲**: 会社単位 + ユーザー単位（会社全体で共有、担当者にも紐づく）

**検索可能なフィールド**:
- `name`（名前、見込み客名）
- `company`（会社名、企業名）
- `status`（ステータス、状況）

**使用例**:
- 「見込み客について教えて」
- 「リード一覧を確認したい」

---

### 1.9 営業活動管理

**コレクション**: `salesActivities`

**検索範囲**: 会社単位 + ユーザー単位（会社全体で共有、担当者にも紐づく）

**検索可能なフィールド**:
- `title`（タイトル、件名、活動内容）
- `customerName`（顧客名、取引先名）
- `description`（詳細、内容、記録）

**使用例**:
- 「営業活動について教えて」
- 「訪問記録を確認したい」

---

### 1.10 顧客管理

**コレクション**: `customers`

**検索範囲**: 会社単位（会社全体で共有）

**検索可能なフィールド**:
- `name`（名前、顧客名、氏名、担当者名）
- `company`（会社、会社名、企業名、取引先）
- `email`（メール、メールアドレス、Eメール）
- `phone`（電話、電話番号、TEL）
- `notes`（メモ、備考、ノート、記録）

**使用例**:
- 「顧客について教えて」
- 「顧客リストを確認したい」

---

### 1.11 議事録管理

**コレクション**: `meetingNotes`

**検索範囲**: 会社単位（会社全体で共有）

**検索可能なフィールド**:
- `title`（タイトル、議題、件名、会議名）
- `notes`（議事録、内容、備考、記録、メモ）
- `location`（場所、会議室、ロケーション）

**使用例**:
- 「議事録について教えて」
- 「会議の記録を確認したい」

---

## 2. アクション検出機能（Phase 1実装済み）

ユーザーの質問から「何をしたいか」を検出し、適切なページへのリンクを提供します。

### 2.1 サポートしているアクション

**Intent（意図）**:
- `create`（作成）
- `check`（確認）
- `search`（検索）
- `update`（更新）
- `delete`（削除）

**Domain（対象）**:
- `invoice`（請求書）
- `todo`（TODO）
- `customer`（顧客）
- `contract`（契約書）
- `document`（文書）

### 2.2 使用例

**請求書作成**:
- 「〇〇さんに請求書を作って」
- 「請求書を作成したい」

**TODO作成**:
- 「〇〇というタスクを作って」
- 「タスクを作成したい」

**確認**:
- 「請求書を確認したい」
- 「顧客情報を確認したい」
- 「契約書を確認したい」

**更新**:
- 「請求書を更新したい」
- 「タスクを更新したい」
- 「顧客情報を更新したい」

**削除**:
- 「請求書を削除したい」
- 「タスクを削除したい」
- 「顧客情報を削除したい」

---

## 3. 一般的な質問パターン

以下のような一般的な質問に対応しています：

- 「〇〇について教えて」
- 「〇〇を確認したい」
- 「〇〇を見たい」
- 「〇〇の一覧」
- 「〇〇を全部見せて」

一般的な質問の場合、該当するメニュー項目のすべてのデータを返します。

---

## 4. 特定セクション検索

契約書管理など、セクション構造を持つデータの場合、特定のセクションのみを取得できます。

**使用例**:
- 「Signal.の料金について教えて」→ Signal.契約書の料金セクションのみ
- 「Signal.のQ&Aを確認したい」→ Signal.契約書のQ&Aセクションのみ

---

## 5. 制限事項

### 5.1 検索範囲

- **ユーザー単位**: TODOリスト、進捗メモなど（自分のデータのみ）
- **会社単位**: 契約書管理、顧客管理、議事録管理など（会社全体で共有）
- **会社単位 + ユーザー単位**: 営業案件、見込み客管理など（会社全体で共有 + 担当者にも紐づく）

### 5.2 メタデータベース検索が未実装のメニュー項目

以下のメニュー項目は、メタデータベース検索が実装されていません（今後の実装予定）:

- テンプレート管理
- ドキュメント管理
- カレンダー（イベント管理）

---

## 6. 今後の改善予定

### Phase 2以降（未実装）

1. **エンティティ抽出の改善**: DBから実データを取得してエンティティを解決
2. **時刻連動のTODO検索**: 「今日のタスク」「明日のタスク」など、時刻を考慮した検索
3. **より自然な応答**: よりAIらしい、考えている感のある応答生成
4. **複数データの比較**: 複数のデータを比較して回答を生成

---

## 7. 技術的な詳細

### 7.1 メタデータベース検索

各メニュー項目には`aiChatMetadata`が定義されており、以下の情報を含みます：

- `collectionName`: Firestoreのコレクション名
- `searchableFields`: 検索可能なフィールドの定義
- `fieldMappings`: 日本語名と英語フィールド名のマッピング
- `searchByCompany`: 会社単位で検索するかどうか
- `searchByUser`: ユーザー単位で検索するかどうか

### 7.2 アクション検出（Phase 1）

正規表現ベースのアクション検出が実装されています。今後、より高度な自然言語処理への移行が予定されています。

---

## 8. 💡 使用方法について

### 8.1 基本的な使い方

AIチャットは、画面下部のチャット入力欄に質問を入力するだけで使用できます。

**基本的な質問の例**:
- 「TODOリストについて教えて」
- 「顧客情報を確認したい」
- 「契約書を確認したい」

**アクションを含む質問の例**:
- 「請求書を作成したい」
- 「タスクを更新したい」
- 「顧客情報を削除したい」

### 8.2 効果的な質問のコツ

1. **メニュー名や項目名を明確に指定**
   - ✅ 「TODOリストについて教えて」
   - ❌ 「タスクについて」→ どのメニューか不明確

2. **一般的な質問の方が多くの結果が返る**
   - ✅ 「契約書について教えて」→ すべての契約書を表示
   - ❌ 「契約書を探して」→ 検索結果が限定される場合がある

3. **特定のセクションを指定する（契約書管理）**
   - ✅ 「Signal.の料金について教えて」→ Signal.契約書の料金セクションのみ
   - ✅ 「Signal.について教えて」→ Signal.契約書の全体

4. **ステータスを指定する（TODOリスト）**
   - ✅ 「共有事項について教えて」→ 共有ステータスのTODOのみ
   - ✅ 「進行中のタスクを確認したい」→ 進行中ステータスのTODOのみ

### 8.3 アクション検出の使い方

「作成」「確認」「更新」「削除」などのアクションを含む質問をすると、適切なページへのリンクが提供されます。

**作成アクション**:
- 「〇〇さんに請求書を作って」→ 請求書発行ページへのリンク
- 「〇〇というタスクを作って」→ TODOリストページへのリンク

**確認アクション**:
- 「請求書を確認したい」→ 請求書発行ページへのリンク
- 「顧客情報を確認したい」→ 顧客管理ページへのリンク

---

## 9. 📄 文書検索（契約書管理）

契約書管理では、タイトルや説明で検索できるほか、特定のセクションのみを取得する「セクション検索」が利用できます。

### 9.1 基本的な文書検索

**契約書の全体を検索**:
- 「契約書について教えて」→ すべての契約書を表示
- 「Signal.について教えて」→ Signal.契約書の全体を表示

### 9.2 セクション検索

契約書は複数のセクション（料金、Q&A、特徴など）で構成されています。特定のセクションのみを取得できます。

**セクション検索の形式**:
```
（契約書タイトル）の（セクション名）について教えて
```

**使用例**:
- 「Signal.の料金について教えて」→ Signal.契約書の料金セクションのみ
- 「Signal.のQ&Aを確認したい」→ Signal.契約書のQ&Aセクションのみ
- 「Signal.の特徴について教えて」→ Signal.契約書の特徴セクションのみ
- 「Signal.の手順について教えて」→ Signal.契約書の手順セクションのみ

**利用可能なセクション名**:
- **料金**: 「料金」「価格」「費用」「金額」「コスト」
- **説明**: 「説明」「概要」「内容」「詳細」「紹介」
- **特徴**: 「特徴」「機能」「仕様」「スペック」
- **手順**: 「手順」「使い方」「方法」「手続き」「プロセス」
- **サポート**: 「サポート」「サポート情報」「ヘルプ」「支援」
- **規則**: 「規則」「ルール」「規約」「規定」
- **条件**: 「条件」「条項」「約款」「規約」
- **Q&A**: 「Q&A」「質問」「FAQ」「よくある質問」「質疑応答」

### 9.3 セクション検索の仕組み

1. **タイトルとセクションの両方を指定**:
   - 「Signal.の料金について教えて」→ Signal.というタイトル + 料金というセクション
   - 両方が一致する場合のみ、そのセクションを返します

2. **タイトルのみ指定**:
   - 「Signal.について教えて」→ Signal.というタイトル
   - タイトルが一致する契約書の全体を返します

3. **セクション名のみ指定**:
   - 「料金について教えて」→ 料金というセクション
   - すべての契約書から料金セクションを返します（現在の実装では、一般的な質問の場合は全体を返します）

### 9.4 注意事項

- セクション名が正しく認識されない場合、全体が返される場合があります
- 一般的な質問（「教えて」など）の場合、セクション検索が適用されない場合があります
- セクションが存在しない場合、「情報が見つかりませんでした」と表示されます

---

## 10. ❓ よくある質問

### Q1: 「情報が見つかりませんでした」と表示される

**A**: 以下の原因が考えられます：

1. **データが存在しない**
   - Firestoreに該当するデータが存在しない
   - 検索範囲（ユーザー単位/会社単位）に該当するデータがない

2. **質問の表現が適切でない**
   - メニュー名や項目名が明確でない
   - 一般的な質問（「教えて」など）を使用していない

**解決方法**:
- 「〇〇について教えて」という形式で質問する
- メニュー名を明確に指定する（例：「TODOリストについて教えて」）

### Q2: セクション検索がうまく動作しない

**A**: セクション検索が動作しない場合、以下の点を確認してください：

1. **タイトルとセクション名の両方を指定**
   - ✅ 「Signal.の料金について教えて」
   - ❌ 「料金について教えて」（タイトルが指定されていない）

2. **正しいセクション名を使用**
   - 利用可能なセクション名は「料金」「Q&A」「特徴」「手順」「サポート」「規則」「条件」「説明」です

3. **一般的な質問の場合はセクション検索が適用されない**
   - 「〇〇について教えて」という一般的な質問の場合、全体が返される場合があります

### Q3: 自分のTODOが見つからない

**A**: TODOリストはユーザー単位で検索されます。以下の点を確認してください：

1. **ログインしているユーザーのデータのみ検索対象**
   - 他のユーザーのTODOは検索結果に含まれません

2. **共有事項は検索できる**
   - 「共有事項について教えて」と質問すると、共有ステータスのTODOが表示されます

### Q4: 契約書が見つからない

**A**: 契約書管理は会社単位で共有されます。以下の点を確認してください：

1. **会社名が正しく設定されている**
   - ユーザーの`companyName`が正しく設定されている必要があります

2. **契約書の`companyName`が設定されている**
   - 契約書の`companyName`がユーザーの`companyName`と一致している必要があります

3. **一般的な質問を使用**
   - 「契約書について教えて」という一般的な質問を使用してください

### Q5: アクション検出が動作しない

**A**: アクション検出が動作しない場合、以下の点を確認してください：

1. **アクション動詞を含める**
   - ✅ 「請求書を作って」
   - ✅ 「タスクを作成したい」
   - ❌ 「請求書が欲しい」（アクション動詞がない）

2. **ドメイン名を含める**
   - ✅ 「請求書を作って」→ `invoice`ドメイン
   - ✅ 「タスクを作って」→ `todo`ドメイン
   - ❌ 「作って」→ ドメインが不明確

3. **一般的な検索動詞はアクション検出の対象外**
   - 「教えて」「見せて」などの一般的な検索動詞は、通常の検索ロジックが使用されます

### Q6: 検索結果が多すぎる/少なすぎる

**A**: 検索結果を調整するには、以下の方法を試してください：

1. **より具体的な質問をする**
   - 一般的な質問（「教えて」）→ 多くの結果
   - 具体的な質問（「〇〇について教えて」）→ 限定された結果

2. **セクション名を指定する（契約書管理）**
   - 「Signal.の料金について教えて」→ 特定のセクションのみ

3. **ステータスを指定する（TODOリスト）**
   - 「共有事項について教えて」→ 特定のステータスのみ
   - 「進行中のタスクを確認したい」→ 特定のステータスのみ

### Q7: 他のユーザーのデータが見えない

**A**: 検索範囲によって、検索対象が異なります：

1. **ユーザー単位のデータ**
   - TODOリスト、進捗メモなどは自分のデータのみ検索対象です

2. **会社単位のデータ**
   - 契約書管理、顧客管理、議事録管理などは会社全体で共有されます

3. **会社単位 + ユーザー単位のデータ**
   - 営業案件、見込み客管理などは会社全体で共有されますが、担当者にも紐づきます

### Q8: エラーメッセージが表示される

**A**: エラーが発生した場合、以下の点を確認してください：

1. **ログイン状態**
   - ログインしている必要があります

2. **権限**
   - 必要な権限があることを確認してください

3. **ネットワーク接続**
   - ネットワーク接続を確認してください

4. **Firestore接続**
   - Firestoreへの接続を確認してください

**解決方法**:
- ページをリロードして再度試してください
- しばらく時間をおいてから再度試してください
- 問題が続く場合は、管理者に問い合わせください

---

## 11. 使用上の注意

1. **一般的な質問を推奨**: 「〇〇について教えて」などの一般的な質問の方が、より多くの結果が返されます
2. **特定のセクション検索**: 契約書管理など、セクション構造を持つデータの場合、特定のセクション名を指定すると、そのセクションのみが返されます
3. **アクション検出**: 「作成」「確認」「更新」「削除」などのアクションを含む質問の場合、適切なページへのリンクが提供されます
4. **検索範囲**: ユーザー単位のデータは自分のデータのみ、会社単位のデータは会社全体で共有されます

